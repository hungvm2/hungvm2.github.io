<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Đọc và phân tích Paper &#34;YOLO9000: Better, Faster, Stronger&#34; - HungVM2&#39;s Notes </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="" />
    <meta property="og:site_name" content="HungVM2&#39;s Notes" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://hungvm2.github.io/grasping-yolov2-content/" />
    <meta property="og:title" content="Đọc và phân tích Paper &#34;YOLO9000: Better, Faster, Stronger&#34;" />
    <meta property="og:image" content="https://hungvm2.github.io" />
    <meta property="og:description" content="" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="Đọc và phân tích Paper &#34;YOLO9000: Better, Faster, Stronger&#34;" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:image" content="https://hungvm2.github.io" />

    <link rel="canonical" href="https://hungvm2.github.io/grasping-yolov2-content/">

    <link rel="stylesheet" href="https://hungvm2.github.io/css/bootstrap.min.css" />

    
    <link rel="stylesheet" href="https://hungvm2.github.io/css/github-gist.min.css" />
    
    <link rel="stylesheet" href="https://hungvm2.github.io/css/custom.css" />

    
    <link rel="stylesheet" href="https://hungvm2.github.io/css/new-custom.css" />



    
    <link href="https://hungvm2.github.io/index.xml" rel="alternate" type="application/rss+xml" title="HungVM2&#39;s Notes" />
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
      MathJax = {
        tex: {
          tags: 'all',
        inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
    
    <div class="mt-xl header">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-auto">
                <a href="https://hungvm2.github.io">
                    <h1 class="name">HungVM2&#39;s notes</h1>
                </a>
            </div>
        </div>

        <div class="row justify-content-center">
            <ul class="nav nav-primary">
                
                <li class="nav-item">
                    <a class="nav-link" href="https://hungvm2.github.io/">
                        
                        Articles
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://hungvm2.github.io/about">
                        
                        About
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-lg-8">
                    <h1 class="mx-0 mx-md-4">Đọc và phân tích Paper &#34;YOLO9000: Better, Faster, Stronger&#34;</h1>
                    <div class="markdown">
                        
    <p>Tiếp theo trong series YOLO, ở bài viết này, chúng ta hãy cùng đọc và phân tích nội dung của paper &ldquo;<strong>YOLO9000: Better, Faster, Stronger</strong>&rdquo; published tháng 12 năm 2016 nhé!</p>
<p>Vì mục đích của series này là muốn đi sâu hơn vào sự tiến hoá của YOLO qua từng version, nên mình sẽ chỉ <strong>tập trung vào kiến trúc</strong> của mô hình, cũng như các <strong>phương pháp tối ưu hiệu năng và độ chính xác (FPS/mAP) mới</strong> được sử dụng so với version trước.</p>
<h3 id="i-đọc-paper">I. Đọc Paper</h3>
<blockquote>
<p>Trong phần &ldquo;Đọc Paper&rdquo; này, mình sẽ tóm lược lại những ý chính của tác giả, có bỏ qua một số nội dung&hellip; Khi đọc sẽ có các reference (có dạng [<a style="color:red;">?</a>]). Bạn có thể click vào các dấu hỏi đó để dẫn xuống phần &ldquo;Hiểu Paper&rdquo; bên dưới để đọc sâu hơn về vấn đề được đề cập.</p>
</blockquote>
<h4 id="1-giới-thiệu-chung-về-model">1. Giới thiệu chung về model</h4>
<p>Tác giả giới thiệu hệ thống detect objection mới, tên là: <strong>YOLO9000</strong>. So với hệ thống trước, hệ thống này có các điểm mới:</p>
<ul>
<li>Phần detection của hệ thống có tên là <strong>YOLOv2</strong> (Better và Faster)
<ul>
<li>Vẫn xử lý được real-time</li>
<li>Xử lý được <strong>input với kích thước khác nhau</strong></li>
<li><strong>Trade-off giữa độ chính xác và hiệu năng</strong>: Đạt 76.8 mAP/67 FPS hoặc 78.6 mAP/40 FPS trên VOC 2007</li>
</ul>
</li>
<li>Kỹ thuật training cùng nhau trên cả dữ liệu object detection và classification, giúp hệ thống có thể detect được trên 9000 lớp đối tượng khác nhau (Stronger)</li>
</ul>
<h4 id="2-các-cải-tiến-so-với-yolov1">2. Các cải tiến so với YOLOv1</h4>
<h5 id="21-better">2.1. Better</h5>
<div class="text-center my-3">
<figure class="figure">
  <img src="https://hungvm2.github.io/images/yolov2/better.png" alt="Improvement in every technique" class="figure-img">
  <figcaption class="figure-caption">Ảnh 1: Sử cải thiện mAP cho từng kỹ thuật mới được sử dụng ở YOLOv2 so với YOLOv1</figcaption>
</figure>
</div>
<p>So với YOLOv1, model detection YOLOv2 đạt độ chính xác cao hơn đáng kể nhờ sử dụng những kỹ thuật mới sau:</p>
<ul>
<li><em>Batch Normalization</em>: Tác giả thêm layer Batch Normalization vào tất cả các lớp Conv Layer trong Network và không sử dụng layer Drop out như ở YOLOv1. Kỹ thuật này giúp regularize model, giúp model cải thiện 2% mAP. [<a href="#batch_norm" style="color:red;">?</a>]<a name="batch_norm_b"></a></li>
<li><em>High Resolution Classifier</em>: giống như YOLOv1, YOLOv2 cũng train trước các lớp Conv layer trong một mạng classification, tuy nhiên sử dụng input size $448 \times 448$ thay vì $224 \times 224$ như YOLOv1. Việc train trước các lớp Conv Layer với input độ phân giải cao đã giúp cho Network trích xuất đặc trưng tốt hơn, cải thiện thêm 4% mAP.</li>
<li>Sử dụng <em>Anchor Boxes</em>: Thay vì chỉ quy định số lượng Bounding box và để model tự predict ra coordinates của các Bounding boxes như ở YOLOv1, YOLOv2 sử dụng một tập 5 Boxes có sẵn với các kích thước cố định gọi là các Anchor boxes và predict offset của bounding box so với các Anchor boxes. Kỹ thuật này giúp model cải thiện 7% recall.</li>
<li><em>Dimension Clusters</em>: Thay vì tự chọn kích thước các Anchor boxes, tác giả sử dụng K-means clustering trên tập dữ liệu training bounding box để tự động tìm ra các kích thước và tỉ lệ phù hợp nhất.</li>
<li><em>Direct location prediction</em>: predict toạ độ tâm của bounding box gắn với vị trí của grid cell tương ứng. Kỹ thuật này giúp cải thiện 5% độ chính xác</li>
<li><em>Fine-grained Features</em>: concatenate feature map có độ phân giải cao hơn ở layer trước đó với feature map của layer cuối cùng để tạo thành output layer. Kỹ thuật này giúp cải thiện 1% độ chính xác</li>
<li><em>Multi-Scale training</em>: Do kiến trúc mới của Network không sử dụng FC layers nên có thể thay đổi input size tuỳ ý. Trong khi training, tác giả thay đổi input size với kích thước ngẫu nhiên sau mỗi 10 batches. Kỹ thuật này giúp Network có thể predict tốt với input ở những kích thước, độ phân giải khác nhau. Bên dưới là kết quả độ chính xác và hiệu năng của YOLOv2 ứng với các input size khác nhau:</li>
<li>Thêm <em>passthrough layer</em>: để model có thể sử dụng fine grain features của các layer trước đó</li>
</ul>
<h5 id="22-faster">2.2 Faster</h5>
<p>YOLOv2 cũng nhanh hơn nhờ cải tiến sau:</p>
<ul>
<li>Kiến trúc của Network với tên gọi là Darknet-19:
<ul>
<li>Gồm 29 Conv layers và 5 Max pooling layers</li>
<li>Sử dụng Batch normalization để ổn định quá trình training, tăng tốc hội tụ và regularize model</li>
<li><strong>Global average pooling</strong> ở bước prediction</li>
<li>$1 \times 1$ filters để compress feature presentation giữa các $3 \times 3$ Conv layers.</li>
</ul>
</li>
</ul>
<h5 id="23-stronger">2.3. Stronger</h5>
<p>Các kỹ thuật được sử dụng giúp hệ thống có thể detect được hơn 9000 lớp đối tượng:</p>
<ul>
<li>Hierarchical classification</li>
<li>Dataset combination with WordTree</li>
<li>Joint classification and detection</li>
</ul>
<p>Vì đây không phải là các kỹ thuật giúp tối ưu FPS và mAP của hệ thống nên mình xin phép không đi vào chi tiết các kỹ thuật được tác giả giới thiệu ở phần này.</p>
<h4 id="3-training">3. Training:</h4>
<h5 id="31-train-trước-các-lớp-conv-layer-trong-mạng-classifier">3.1. Train trước các lớp Conv layer trong mạng classifier:</h5>
<div class="text-center my-3">
<img src="https://hungvm2.github.io/images/yolov2/classification_network.png" class="img-fluid" alt="Error Analysis">
</div>
<p>Sử dụng Dataset Imagenet 1000 class, gồm 2 bước:</p>
<p>Bước 1: traing trước 160 epoch với input size $224 \times 224$</p>
<ul>
<li>Optimization algorithm: SGD</li>
<li>Learning rate schedule: polynomial rate decay</li>
<li>Regularization techniques: Weight decay, Momentum, Data augmentation</li>
</ul>
<p>Bước 2: traing tiếp 10 epochs với input size $448 \times 448$</p>
<ul>
<li>Learning rate: start với rate $10^{-3}$</li>
<li>Regularization techniques: Weight decay, Momentum, Data augmentation</li>
</ul>
<h5 id="32-train-mạng-detection">3.2. Train mạng detection:</h5>
<h5 id="321-set-up-kiến-trúc-mạng">3.2.1. Set up kiến trúc mạng:</h5>
<ul>
<li>Giữ lại toàn bộ phần Conv layers của Network trên, trừ Conv layer cuối</li>
</ul>
<div class="text-center my-3">
<img src="https://hungvm2.github.io/images/yolov2/conv_layers.png" class="img-fluid" alt="Error Analysis">
</div>
<ul>
<li>Thêm 3 $3 \times 3 \times 1024$ Conv layers</li>
<li>Thêm $1 \times 1$ Conv layer với số filter bằng kích thước output (125 filters)</li>
<li>Thêm <em>passthrough layer</em></li>
</ul>
<h5 id="322-hàm-loss">3.2.2. Hàm loss:</h5>
<h4 id="333-các-kỹ-thuật-khi-training">3.3.3. Các kỹ thuật khi training:</h4>
<ul>
<li>Learning rate schedule</li>
<li>Regularization techniques: Weight decay, Momentum, Data augmentation</li>
</ul>
<h4 id="3-so-sánh-độ-chính-xác-và-hiệu-năng-với-các-mô-hình-khác">3. So sánh độ chính xác và hiệu năng với các mô hình khác</h4>
<p>YOLOv2 đạt độ chính xác tương đương hoặc nhỉnh hơn so với các thuật toán khác cùng thời điểm, trong khi nhanh hơn nhiều lần</p>
<div class="text-center my-3">
<figure class="figure">
  <img src="https://hungvm2.github.io/images/yolov2/comparision_voc2007.png" alt="Comparision on VOC 2007" class="figure-img">
  <figcaption class="figure-caption">So sánh mAP/FPS của YOLOv2 so với các hệ thống Object detection khác trên tập VOC 2007</figcaption>
</figure>
</div>
<div class="text-center my-3">
<figure class="figure">
  <img src="https://hungvm2.github.io/images/yolov2/comparision_voc2012.png" alt="Comparision on VOC 2012" class="figure-img">
  <figcaption class="figure-caption">So sánh mAP/FPS của YOLOv2 so với các hệ thống Object detection khác trên tập VOC 2012</figcaption>
</figure>
</div>
<h3 id="ii-hiểu-paper">II. Hiểu Paper</h3>
<blockquote>
<p>Trong phần &ldquo;Hiểu Paper&rdquo; này, mình sẽ đi vào phân tích cũng như dẫn lại các giải thích của tác giả về các lý do tại sao tác giả chọn hướng tiếp cận đó, cũng như các thuật ngữ, công thức trong paper&hellip;</p>
</blockquote>
<h3 id="iii-nguồn-tham-khảo">III. Nguồn tham khảo:</h3>
<ul>
<li><a href="https://arxiv.org/abs/1506.02640">You Only Look Once: Unified, Real-Time Object Detection</a></li>
<li><a href="https://github.com/pjreddie/darknet">Darknet</a></li>
</ul>



                    </div>
                </div>
            </div>
        </div>
    </div>


    


    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/stan.min.js" defer></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    

    
    
        
<script src="https://hungvm2.github.io/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>
</html>
